--v2
local DiscordLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/UI-Libs/main/discord%20lib.txt"))()

local win = DiscordLib:Window("KKR HUB")
local serv = win:Server("หมวดหมู่", "rbxassetid://13440848912")
local tgls = serv:Channel("Auto-Farm-ขนส่ง")

local autofarm = false

tgls:Toggle("Auto-Farm", false, function(bool)
    autofarm = bool

    task.spawn(function()
        while autofarm do
            local player = game.Players.LocalPlayer
            local char = player.Character
            local customerName = player.Name .. "_Customer"

            local function pressPrompt(prompt)
                if prompt then
                    prompt.HoldDuration = 0
                    prompt:InputHoldBegin()
                    wait(prompt.HoldDuration or 0)
                    prompt:InputHoldEnd()
                    return true
                end
                return false
            end

            local customer
            while autofarm do
                -- วาร์ปไปรับเควส
                if char and char:FindFirstChild("HumanoidRootPart") then
                    char.HumanoidRootPart.CFrame = CFrame.new(373.683746, 10.8152561, 121.489975)
                end

                task.wait(0.5)

                -- หาปุ่มรับเควส
                local prompt = workspace:FindFirstChild("Deliverys")
                    and workspace.Deliverys:FindFirstChild("Transport")
                    and workspace.Deliverys.Transport:FindFirstChild("Interact")
                    and workspace.Deliverys.Transport.Interact:FindFirstChild("Prompt")

                if not pressPrompt(prompt) then
                    warn("ไม่พบ Prompt รับเควส")
                    break
                end

                task.wait(0.5)

                -- หาลูกค้า
                customer = workspace:FindFirstChild(customerName)
                if customer and customer:FindFirstChild("HumanoidRootPart") then
                    break
                end

                -- ถ้าไม่เจอลูกค้า ให้เช็คว่า Navigate อยู่ใน Part ไหม ถ้าใช่ให้วาร์ปไปที่ Part
                local pickupStores = workspace:FindFirstChild("Deliverys")
                    and workspace.Deliverys:FindFirstChild("Transport")
                    and workspace.Deliverys.Transport:FindFirstChild("PickupStores")

                if pickupStores and pickupStores:FindFirstChild("Part") then
                    local part = pickupStores.Part
                    if part:FindFirstChild("Navigate") and char and char:FindFirstChild("HumanoidRootPart") then
                        warn("ไม่เจอลูกค้า วาร์ปไปหา Part ที่มี Navigate")
                        char.HumanoidRootPart.CFrame = part.CFrame + Vector3.new(0, 3, 0)
                        task.wait(2)
                        break
                    end
                end

                task.wait(0.5)
            end

            if not autofarm then return end

            -- ถ้าหาลูกค้าเจอ วาร์ปไปด้านหน้าและส่งของ
            if customer and customer:FindFirstChild("HumanoidRootPart") then
                local hrp = customer.HumanoidRootPart
                local frontPos = hrp.Position + hrp.CFrame.LookVector * 3
                char.HumanoidRootPart.CFrame = CFrame.new(frontPos, hrp.Position)

                task.wait(5)

                local deliverPrompt = hrp:FindFirstChild("Prompt")
                pressPrompt(deliverPrompt)
            end

            task.wait(2)
        end
    end)
end)
