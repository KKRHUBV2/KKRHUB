-- สร้าง ScreenGui ที่เหมาะสำหรับมือถือ
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KKRHubScreenGui"
screenGui.Parent = game.CoreGui
screenGui.ResetOnSpawn = false

-- สร้าง Frame หลักขนาดเล็ก
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0.3, 0, 0.2, 0)  -- ขนาดเล็กพอสมควร
mainFrame.Position = UDim2.new(0.35, 0, 0.8, 0)  -- ตำแหน่งอยู่ข้างล่างของหน้าจอ
mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false  -- ซ่อนเริ่มต้น
mainFrame.Parent = screenGui

-- สร้าง Header (ชื่อ "KKR HUB")
local header = Instance.new("TextLabel")
header.Size = UDim2.new(1, 0, 0.2, 0)
header.Position = UDim2.new(0, 0, 0, 0)
header.Text = "KKR HUB"
header.TextColor3 = Color3.fromRGB(255, 255, 255)
header.BackgroundColor3 = Color3.fromRGB(30, 144, 255)
header.TextSize = 24
header.TextAlignment = Enum.TextAlignment.Center
header.TextXAlignment = Enum.TextXAlignment.Center
header.TextYAlignment = Enum.TextYAlignment.Center
header.Parent = mainFrame

-- สร้างปุ่ม Toggle สำหรับเปิด/ปิดระบบ
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0.8, 0, 0.6, 0)  -- ขนาดเล็ก
toggleButton.Position = UDim2.new(0.1, 0, 0.2, 0)
toggleButton.Text = "เปิด/ปิด ระบบ"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.BackgroundColor3 = Color3.fromRGB(30, 144, 255)
toggleButton.TextSize = 18
toggleButton.Parent = mainFrame

-- ตัวแปรเก็บสถานะของ Toggle
local toggleRunning = false

-- เมื่อกดปุ่ม Toggle
toggleButton.MouseButton1Click:Connect(function()
    toggleRunning = not toggleRunning
    if toggleRunning then
        toggleButton.Text = "ปิด ระบบ"  -- เปลี่ยนข้อความเมื่อเปิดระบบ
        print("เปิดระบบ")
        mainFrame.Visible = true  -- แสดง GUI

        task.spawn(function()
            while toggleRunning do
                -- ขั้นตอนแรก: Interact ก่อน
                for _, item in pairs(workspace.Deliverys.Transport.Interact:GetDescendants()) do
                    if not toggleRunning then return end
                    if item:IsA("ProximityPrompt") then
                        fireproximityprompt(item)
                    end
                end

                task.wait(1)

                local player = game.Players.LocalPlayer
                local character = workspace:FindFirstChild(player.Name .. "_Customer")

                -- ถ้าไม่มี character ให้ไปกด PickupStores
                if not character then
                    for _, part in pairs(workspace.Deliverys.Transport.PickupStores:GetChildren()) do
                        if not toggleRunning then return end
                        local prompt = part:FindFirstChildWhichIsA("ProximityPrompt")
                        if prompt then
                            fireproximityprompt(prompt)
                            break
                        end
                    end

                    task.wait(1)
                    character = workspace:FindFirstChild(player.Name .. "_Customer")
                end

                -- ถ้ายังไม่มี character หลังจาก PickupStores → กลับไป Interact ใหม่ในรอบถัดไป
                if character then
                    local hrp = character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        local prompt = hrp:FindFirstChildWhichIsA("ProximityPrompt")
                        if prompt then
                            fireproximityprompt(prompt)
                        end
                    end
                end

                task.wait(2) -- รอรอบถัดไป (ปรับตามความเร็วที่ต้องการ)
            end
        end)

    else
        toggleButton.Text = "เปิด ระบบ"  -- เปลี่ยนข้อความเมื่อปิดระบบ
        print("ปิดระบบ")
        mainFrame.Visible = false  -- ซ่อน GUI
    end
end)

-- ฟังก์ชันทำให้กรอบสามารถลากได้
local dragging, dragInput, mousePos, startPos

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        startPos = mainFrame.Position
        mousePos = input.Position

        input.Changed:Connect(function()
            if dragging then
                local delta = input.Position - mousePos
                mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
    end
end)

header.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

print("KKR")
